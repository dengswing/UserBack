# 生产系统设计
================

维护人 | 版本号 | 描述 | 日期
--- | --- | ---
张秀云 	| 0.1 | 初版 | 2015-07-2
张秀云 	| 0.2 | 增加生产队列 | 2015-09-22
张秀云 	| 0.3 | 增加生产助手 | 2015-10-27
张秀云 	| 0.4 | 增加加工车床, 部件组装台, 实验柜, 修复台 | 2015-12-01
张秀云 	| 0.5 | 增加实验台修复功能 | 2016-03-01

---
## 1. 设计

### 1.1 概念
* 玩家通过拆解旧家电获取生产材料
* 产品也属于生产材料
* 产品可以通过完成订单,售卖,完成任务获取经验和游戏币

	* 初级工作台
		* 进行低级产品和低级部件的生产,这部分产品主要用于满足初期经营的订单和任务,用于积累游戏币.
	* 高级工作台
		* 进行高级产品的生产,这部分产品主要用于特殊建设和稀有产品的生产

* 领取生产完成的产品时如果背包容量满则提示背包满的错误.
* 生产产品时,如果存在材料不足则可以批量补足之后立即进行生产.

* 拆解队列数量类型标识: infoType 4
* 生产队列数量类型标识: infoType 5

* 队列类型标识:
	* 工作台拆解队列  		type 20
	
	* 工作台生产队列  		type 21
	* 加工车床生产队列 		type 22
	* 部件组装台生产队列 		type 23 
	* 实验柜生产队列 			type 24
	* 修复台生产队列 			type 25

* 初级工作台和高级工作台需要为游戏玩家初始化一些生产配方

* 生产助手
	* 在玩家修复了学习模块之后,增加生产助手功能
	* 产品分类两类：1.大叔会做的产品，2.AI 会做的产品。
	
* 加工车床分页签展示可生产物品.
* 通过完成特定的任务来解锁功能
* 解锁部分 请参考 <<功能解锁系统设计.md>>

* SG实验台需要修复之后才能进行生产行为.
	* 实验台功能需要解锁才开启, 处于未修复状态,
	* 修复需要cd时间,cd时间可加速, 需要材料
	* 修复之后处于可生产状态

## 2. 配置

### 2.1 产品生产配方配置表
配置表名称：formula   
配置表路径: config/{lang}/sg_product/

配置表结构：

字段名	 | 类型 | 默认值 | 使用者 | 索引 | 描述 
--- | --- | --- | --- | --- | ---
productDefId | int | - | both | pri | 产品配置表id
type | int | - | both | - | 生产台类型, 请参考队列类型标识
categoryDefId | int | - | client | - | 知识大类
cd | int| - | both | - | 生产时间，以秒为单位
tab | int | - | client | - |页签(1,2..)默认都是1第个页签,如果type为加工车床,则可能为其他页签
canMake | int| - | both | - | 0表示大叔和机器人都能生产,1表示大叔能生产,2表示机器人能生产.
unlock | json | - | both | - | 非任务解锁条件  { "level":count, .. }
productIn | json |- |both| - | 获得 例如: 2.1.c1
productOut | json |- |both| - | 消耗 例如: 2.1.c2
formula | json | - | both | - | 公式 例如: 2.1.c3

<code>
2.1.c1

    {
        "item":[
            {"itemDefId":8位id, "count":1},
            {"itemDefId":8位id, "count":1},
            ...
        ],
        "exp":5,
        "knowledge":[
			8位技能id,
			8位技能id,
			...
		],
		...
    }

<code>
2.1.c2

    {
        "item":[
            {"itemDefId":8位id, "count":1},
            {"itemDefId":8位id, "count":1},
            ...
        ]
    }


<code>
2.1.c3
    {
        "productDefId":8位id,
		"knowledgeDefId":8位id
    }


### 2.2 扩展游戏全局配置表 sg_game_init, 参照 游戏系统设计.md

配置表必须项：

字段名 | 类型 | 默认值 | 描述 
--- | --- | --- | --- 
formulaInit | json | - | 初始生产配方，结构例如: 2.2.c1

<code>
2.1.c1

    {
        "formulaDefId":8位id,
        "formulaDefId":8位id,
        ...
    }

### 2.3 工作台修复配置表
配置表名称：sg_worktable_repair   
配置表路径: config/{lang}/sg_worktable/

配置表结构：

字段名	 | 类型 | 默认值 | 使用者 | 索引 | 描述 
--- | --- | --- | --- | --- | ---
typeId | int | - | both | pri | 生产台类型, 请参考队列类型标识
itemCount | json | - | both | - | 修复所需物品及数量 eg: {1000001:2, 1000002:4}
itemRtime | json | - | both | - | 修复所需物品及修复时间, 单位为秒 eg: {1000001:200, 1000002:4000}
icon | string | - | client | - | icon
name | string | - | client | - | 名称
desc | string | - | client | - | 描述

## 3. 存储结构
### 3.1 队列信息表
表名： sg_list

字段名	 | 类型 | 默认值 | 使用者 | 索引 | 描述 
--- | --- | --- | --- | --- | ---
userId | int | - | both | pri | 玩家用户id
type | int | - | both | - | 队列类型 4 是生产队列  5是 拆解队列
listInfo | json | - | both | - | 生产进度数据  结构如: 3.1.c1 

<code>
3.1.c1

    [
        [
            "itemDefId":8位产品id,
            "completeTime":完成时间, 如果处于未计时状态则为0,
        ],
		...
    ]

### 3.2 生产历史表 
表名：sg_product_compose_history

字段名	 | 类型 | 默认值 | 使用者 | 索引 | 描述 
--- | --- | --- | --- | --- | ---
userId | int | - | both | pri | 玩家用户id
productDefId | int | - | both | - | 合成产品id
count | int | - | both | - | 合成产品数量
updateTime | int | - | both | - | 合成完成时间

### 3.3 工作台状态表 
表名：sg_worktable_status

字段名	 | 类型 | 默认值 | 使用者 | 索引 | 描述 
--- | --- | --- | --- | --- | ---
userId | int | - | both | pri | 玩家用户id
typeId | int | - | both | - | 工作台类型Id
status | int | - | both | - | 工作台状态 0 是未修复状态 1是修复状态
itemRtime | json | - | both | - | 所需物品开始修复时间{1000001:​1456808304, 1000002:​1456808304}


## 4. API
### 4.1 产品生产
接口名：product.compose   
输入：

参数名 | 类型 | 默认值 | 备注
--- | --- | --- | ---
userId  | int | - | 用户id
panelId | int | - | 面板id
reqTime | int | - | 当前请求的unix时间戳
type | int | - | 队列类型 id号参考队列类型标识
productdefId  | int | - | 产品配置表id

输出：
常规的框架结果输出，无具体内容 

### 4.2 收取物品
接口名：product.getProduct   
输入：

参数名 | 类型 | 默认值 | 备注
--- | --- | --- | ---
userId  | int | - | 用户id
panelId | int | - | 面板id
reqTime | int | - | 当前请求的unix时间戳
type | int | - | 队列类型 id号参考队列类型标识
index  | int | - | 队列索引号 

输出：
常规的框架结果输出，无具体内容 

### 4.3 快速跳过生产
接口名：product.quickComposing   
输入：

参数名 | 类型 | 默认值 | 备注
--- | --- | --- | ---
userId  | int | - | 用户id
panelId | int | - | 面板id
reqTime | int | - | 当前请求的unix时间戳
type | int | - | 队列类型 id号参考队列类型标识
index  | int | - | 队列索引号 

### 4.5 扩充栏位
接口名：product.extendList   
输入：

参数名 | 类型 | 默认值 | 备注
--- | --- | --- | ---
userId  | int | - | 用户id
panelId | int | - | 面板id
reqTime | int | - | 当前请求的unix时间戳
type | int | - | 队列类型 id号参考队列类型标识